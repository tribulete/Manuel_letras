<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Letra de la Canción</title>
  <link rel="stylesheet" href="style.css">
  <style>
    /* Asegúrate de que body no tenga márgenes extra */
    body { margin: 0; padding: 2em; }
  </style>
</head>
<body>
  <h1 id="titulo">Cargando...</h1>
  <div id="contenido"></div>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const params = new URLSearchParams(location.search);
    const fichero = params.get("fichero");
    const duracion = parseFloat(params.get("duracion")) || 60; // segundos

    // Mostrar título
    const titulo = fichero.replace(/_/g, ' ').replace('.md', '');
    document.getElementById("titulo").textContent = titulo;

    // Cargar y convertir Markdown
    fetch(fichero)
      .then(r => r.text())
      .then(md => {
        document.getElementById("contenido").innerHTML = marked.parse(md);

        // Una vez inyectado el HTML, espera al próximo repaint
        requestAnimationFrame(() => {
          // Altura total de todo el documento
          const totalHeight = document.documentElement.scrollHeight;
          // Altura visible
          const windowHeight = window.innerHeight;
          // Cuánto hay que desplazar en total
          const scrollDistance = totalHeight - windowHeight;

          if (scrollDistance <= 0) return; // no hay scroll posible

          const totalMs = duracion * 1000;
          const intervalMs = 20;               // frecuencia de paso (20 ms)
          const steps = totalMs / intervalMs;  // número de pasos
          const stepPx = scrollDistance / steps;

          let scrolled = 0;
          const timer = setInterval(() => {
            // mueve el scroll relativo
            window.scrollBy(0, stepPx);
            scrolled += stepPx;
            if (scrolled >= scrollDistance) {
              clearInterval(timer);
            }
          }, intervalMs);
        });
      })
      .catch(err => {
        document.getElementById("contenido").textContent = "Error cargando la letra.";
        console.error(err);
      });
  });
  </script>
</body>
</html>
